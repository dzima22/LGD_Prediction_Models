if __name__ == "__main__":
    from modules import Data_processing as dp
    from modules import Visuals as vis
    from modules import Models as md
    from modules import Evaluation as eval
    from modules import feature_selection as fs
    from modules.config import (loans_path,balance_path,repayment_path)
    
    loans, balance, repayment = dp.load_data(loans_path,balance_path,repayment_path)
    loans=dp.preprocess_loans(loans)
    df=dp.merge_data(loans, balance, repayment)
    df=dp.add_city_column(df)
    df=dp.compute_lgd(df)
    df=dp.calculate_lgd_second_approach(df)
    vis.top_cities(df)
    vis.loan_type_distribution(df)
    vis.heatmap(df)
    vis.average_account_balance(df)
    vis.two_distributions(df)
    results = md.logit_for_PC(df)
    metrics = eval.evaluate_logit_models(results, threshold=0.0094)
    vis.roc_curves(metrics)
    vis.confusion_matrices(metrics)
    results_adasyn = md.logit_model_adasyn(df)
    metrics_adasyn = eval.evaluate_logit_adasyn(results_adasyn, threshold=0.8074)
    vis.roc_adasyn(metrics_adasyn)
    vis.confusion_matrix_adasyn(metrics_adasyn)
    results_rr = md.glm_rr_models(df)
    eval.save_output(results_rr["model1"]["model"], "glm_model1_summary.txt")
    eval.save_output(results_rr["model2"]["model"], "glm_model2_summary.txt")
    results_xgb = md.xgb_models(df)
    metrics_xgb = eval.evaluate_xgb_models(results_xgb)
    vis.xgb_roc_curves(metrics_xgb)
    vis.xgb_comparison_roc(metrics_xgb)
    vis.xgb_conf_matrices(metrics_xgb)
    results_xgb_reg = md.xgb_regression_models(df)
    metrics_xgb_reg = eval.evaluate_xgb_regression(results_xgb_reg)
    vis.xgb_regression_results(metrics_xgb_reg)
    weighted_rr_table = eval.evaluate_weighted_rr(results_xgb_reg, df)
    eval.save_output(weighted_rr_table, "weighted_rr_table.csv")
    results_long = md.train_lgd_nn_models(df)       
    results_short = md.train_lgd_nn_models(df)   
    vis.lgd_loss_curves(results_long["loss_history"], results_short["loss_history"])
    vis.lgd_pred_vs_real(results_long, results_short)
    vis.lgd_error_by_year(df, results_long, results_short)
    hellwig_results, best_subset = fs.hellwig_selection(df, target_col='RR')
    vif_results = fs.vif_selection(df)
    forward_selected = fs.forward_selection(df, target_col='RR')
    eval.save_output(hellwig_results, "hellwig_results.csv")
    eval.save_output(f"Hellwig best subset: {best_subset}", "hellwig_best_subset.txt")
    eval.save_output(vif_results, "vif_results.csv")
    eval.save_output(f"Forward Selection features: {forward_selected}", "forward_selection.txt")



